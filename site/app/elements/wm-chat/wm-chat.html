<link rel="import" href="../../bower_components/polymer/polymer.html">
<link rel="import" href="../../bower_components/paper-input/paper-input.html">
<link rel="import" href="../../bower_components/paper-icon-button/paper-icon-button.html">
<link rel="import" href="../../bower_components/paper-shadow/paper-shadow.html">
<link rel="import" href="../../bower_components/core-icon/core-icon.html">

<polymer-element name="wm-chat" attributes="">
  <template>
    <paper-shadow z="2">
      <link rel="stylesheet" href="wm-chat.css">

        <paper-shadow id="chatlog">
          <div id="chatloginner">
            <table class="log">

              <template repeat="{{ chatmessage in messages }}">
                <tr>
                  <td>{{ chatmessage.user }}</td>
                  <td>{{ chatmessage.message }}</td>
                </tr>
              </template>

            </table>
          </div>
        </paper-shadow>

        <span flex></span>
        <paper-input id="chatInput" on-keydown="{{onKeyDown}}" label="Say something!"></paper-input>
        <paper-icon-button on-click="{{onButton}}" icon="send"></paper-icon-button>
        <span flex></span>
    </paper-shadow>
  </template>
  <script>
    (function () {

      Polymer({
        // define element prototype here
        ready: function() {
          this.messages = [];

          this.submit = function(chatInput) {
            if (chatInput.value && chatInput.value != '') {
              this.fire('chat', {msg: chatInput.value});
              chatInput.value = '';
            }
          }

        },
        onKeyDown: function(event, detail, sender) {
          if (event.keyCode == 13 && !event.shiftKey) {
            this.submit(sender);
          }
        },
        onButton: function(event, detail, sender) {
          this.submit(this.$.chatInput);
        },
      });

    })();
  </script>
</polymer-element>
